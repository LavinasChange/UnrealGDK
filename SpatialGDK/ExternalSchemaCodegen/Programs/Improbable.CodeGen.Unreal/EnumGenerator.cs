using Improbable.CodeGen.Base;
using System;
using System.Linq;

namespace Improbable.CodeGen.Unreal
{
    static class EnumGenerator
    {
        public static string GenerateTopLevelEnum(EnumDefinition enumDefinition, Bundle bundle)
        {
            var enumNamespace = Text.GetNamespaceFromTypeName(enumDefinition.Identifier.QualifiedName);

            return $@"// Generated by {UnrealGenerator.GeneratorTitle}

#pragma once

#include <cstdint>
#include <functional>

{string.Join(Environment.NewLine, enumNamespace.Select(t => $"namespace {t} {{"))}

{GenerateEnum(enumDefinition.Identifier.Name, enumDefinition, bundle)}

{string.Join(Environment.NewLine, enumNamespace.Reverse().Select(t => $"}} // namespace {t}"))}
";
        }
        
        public static string GenerateEnum(string name, EnumDefinition enumDefinition, Bundle bundle)
        {
            var sourceRef = bundle.SchemaBundle.SourceMapV1.SourceReferences[enumDefinition.Identifier.QualifiedName];

            return $@"// Generated from {sourceRef.FilePath}({sourceRef.Line},{sourceRef.Column})
enum class {name} : uint32
{{
{Text.Indent(1, string.Join(Environment.NewLine, enumDefinition.ValueDefinitions.Select(v => $"{v.Identifier.Name} = {v.Value},")))}
}};";
        }
    }
}
